<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»æœé è³¼ç³»çµ±</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
    <h2>ğŸ‘• ç³»æœè³¼è²·ç™»è¨˜</h2>

    <div class="shirt-preview">
        <img src="preview.png" alt="ç³»æœé è¦½åœ–" id="previewImg">
        <p class="price-tag">å–®åƒ¹ï¼š$415</p>
    </div>

    <form id="orderForm">
        <div class="form-group">
            <label for="name">å§“å</label>
            <input type="text" id="name" placeholder="è«‹è¼¸å…¥å§“å" required>
        </div>

        <div class="form-group">
            <label for="studentId">å­¸è™Ÿ</label>
            <input type="text" id="studentId" placeholder="ä¾‹å¦‚ï¼šB110... " required>
        </div>

        <div class="form-group">
            <label for="mail">é›»å­éƒµä»¶(è¯çµ¡ç”¨)</label>
            <div class="input-row">
                <input type="email" id="mail" placeholder="ä¾‹å¦‚ï¼š7777@NCUEmail" required>
                <div class="checkbox-group">
                    <input type="checkbox" id="isMember">
                    <label for="isMember" class="checkbox-label">å·²ç¹³æœƒè²»(æŠµ1ä»¶)</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="size">å°ºå¯¸(2L+20$,3Lä»¥ä¸Š+35$)</label>
            <select id="size">
                <option value="S">S</option>
                <option value="M" selected>M</option>
                <option value="L">L</option>
                <option value="2L">2L</option>
                <option value="3L">3L</option>
                <option value="3L">4L</option>
            </select>
        </div>

        <div class="form-group">
            <label for="amount">è³¼è²·ä»¶æ•¸</label>
            <input type="number" id="amount" value="1" min="1">
        </div>

        <div class="total-price">
            ç¸½è¨ˆé‡‘é¡ï¼š<span id="totalDisplay">$415</span>
        </div>

        <div class="form-group">
            <label for="note">å‚™è¨»</label>
            <input type="text" id="note" placeholder="æœ‰ä»€éº¼å…¶ä»–æƒ³èªªçš„ï¼Ÿ">
        </div>

        <button type="submit" id="submitBtn">é€å‡ºè¨‚å–®</button>
        </form>

    </div>

    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ§¾ è³¼è²·æ”¶æ“š (é è³¼ç™»è¨˜)</h3>
            <hr>
            <div id="receiptDetails">
                </div>
            <button onclick="closeReceipt()" class="close-btn">é—œé–‰ä¸¦è¿”å›</button>
            <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">è«‹æˆªåœ–æ­¤ç•«é¢ä½œç‚ºè³¼è²·è­‰æ˜</p>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw4Grm_l83E730br2TGBsD0pWbeWzTWlHVM6hFkMSr-LmBqJSFtYzTlq4XBzA86LNAkKQ/exec';
        const UNIT_PRICE = 415; 

        const receiptModal = document.getElementById('receiptModal');
        const receiptDetails = document.getElementById('receiptDetails');
        
        const form = document.getElementById('orderForm');
        const submitBtn = document.getElementById('submitBtn');
        const amountInput = document.getElementById('amount');
        const sizeInput = document.getElementById('size');
        const isMemberCheck = document.getElementById('isMember');
        const totalDisplay = document.getElementById('totalDisplay');

        function updateTotal() {
            const amount = parseInt(amountInput.value) || 0;
            const sizeValue = sizeInput.value;
            const isMember = isMemberCheck.checked;
            
            let currentUnitPrice = UNIT_PRICE;

            // 1. è™•ç†å°ºå¯¸åŠ åƒ¹
            if (sizeValue === "2L") {
                currentUnitPrice += 20;
            } else if (sizeValue === "3L" || sizeValue === "4L") {
                currentUnitPrice += 35;
            }
            
            // 2. è¨ˆç®—ç¸½é¡
            let total = amount * currentUnitPrice;

            // 3. è™•ç†æœƒè²»æŠ˜æŠµ (æŠ˜æŠµä¸€ä»¶åŸºç¤å–®åƒ¹ $415)
            if (isMember && amount > 0) {
                total -= currentUnitPrice; 
            }

            // 4. ç¢ºä¿ç¸½é¡ä¸ç‚ºè² æ•¸ (é é˜²è¬ä¸€)
            if (total < 0) total = 0;

            totalDisplay.innerText = `$${total}`;
            return total;
        }

        // ç›£è½æ‰€æœ‰æœƒå½±éŸ¿é‡‘é¡çš„æ¬„ä½
        amountInput.addEventListener('input', updateTotal);
        sizeInput.addEventListener('change', updateTotal);
        isMemberCheck.addEventListener('change', updateTotal);

        function closeReceipt() {
            receiptModal.style.display = 'none';
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const studentId = document.getElementById('studentId').value.trim();
            const mail = document.getElementById('mail').value.trim();
            const finalTotal = updateTotal();

            if (!name || !studentId || !mail) {
                alert("è«‹å¡«å¯«å¿…å¡«æ¬„ä½");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerText = 'è™•ç†ä¸­...';

            const data = {
                name: name,
                studentId: studentId,
                mail: mail,
                isMember: isMemberCheck.checked ? "æ˜¯" : "å¦", // å‚³çµ¦å¾Œå°
                size: sizeInput.value,
                amount: amountInput.value,
                totalPrice: finalTotal,
                note: document.getElementById('note').value
            };

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' }
            })
            .then(() => {
                // å–å¾—ç•¶å‰æ—¥æœŸ
                const now = new Date();
                const dateString = `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${now.getMinutes()}`;
                
                // æº–å‚™æ”¶æ“šå…§å®¹
                const isMemberText = isMemberCheck.checked ? "âœ… å·²ç¹³æœƒè²» (æŠµ1ä»¶)" : "âŒ æœªç¹³æœƒè²»";
                const finalTotal = updateTotal(); // å†æ¬¡ç¢ºèªé‡‘é¡

                receiptDetails.innerHTML = `
                    <div class="receipt-item"><span class="receipt-label">ç™»è¨˜æ—¥æœŸï¼š</span><span class="receipt-value">${dateString}</span></div>
                    <div class="receipt-item"><span class="receipt-label">å§“åï¼š</span><span class="receipt-value">${document.getElementById('name').value}</span></div>
                    <div class="receipt-item"><span class="receipt-label">å­¸è™Ÿï¼š</span><span class="receipt-value">${document.getElementById('studentId').value}</span></div>
                    <div class="receipt-item"><span class="receipt-label">éƒµä»¶ï¼š</span><span class="receipt-value">${document.getElementById('mail').value}</span></div>
                    <div class="receipt-item"><span class="receipt-label">æ•¸é‡ï¼š</span><span class="receipt-value">${document.getElementById('amount').value}</span></div>
                    <div class="receipt-item"><span class="receipt-label">å°ºå¯¸ï¼š</span><span class="receipt-value">${sizeInput.value}</span></div>
                    <div class="receipt-item"><span class="receipt-label">æœƒè²»ç‹€æ…‹ï¼š</span><span class="receipt-value">${isMemberText}</span></div>
                    <hr>
                    <div class="receipt-item" style="font-size: 1.2rem; font-weight: bold; color: #d9534f;">
                        <span>æ‡‰ä»˜ç¸½é¡ï¼š</span><span>$${finalTotal}</span>
                    </div>
                `;

                // é¡¯ç¤ºæ”¶æ“šå½ˆçª—
                receiptModal.style.display = 'flex';

                // é‡ç½®è¡¨å–®
                submitBtn.disabled = false;
                submitBtn.innerText = 'é€å‡ºè¨‚å–®';
                form.reset();
                updateTotal();
            })
            .catch(error => {
                console.error('Error!', error.message);
                alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
                submitBtn.disabled = false;
                submitBtn.innerText = 'é€å‡ºè¨‚å–®';
            });
        });
    </script>
</body>
</html>